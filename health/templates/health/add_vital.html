{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Add Health Vitals" %}{% endblock %}

{% block content %}
<div class="auth-page-wrapper">
    <div class="auth-card animate-fade-in-up">
        
        <h1 class="auth-title">{% trans "Add Health Vitals" %}</h1>
        <p class="auth-subtitle">{% trans "Enter your current health readings." %}</p>

        <form method="post" id="vitalForm" class="needs-loader">
            {% csrf_token %}
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">{% trans "Heart Rate (bpm)" %}</label>
                    <input type="number" name="heart_rate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "SpO₂ (%)" %}</label>
                    <input type="number" name="spo2" step="0.1" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Breathing Rate" %}</label>
                    <input type="number" name="breathing_rate" step="0.1" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Temperature (°C)" %}</label>
                    <input type="number" name="temperature" step="0.1" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Height (cm)" %}</label>
                    <input type="number" name="height_cm" step="0.1" class="form-control" value="{{ student.height_cm }}">
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Weight (kg)" %}</label>
                    <input type="number" name="weight_kg" step="0.1" class="form-control" value="{{ student.weight_kg }}">
                </div>
            </div>
            <button type="submit" class="btn btn-success" style="width:100%;">{% trans "Submit" %}</button>
        </form>
    </div>
</div>

{% if prediction_label %}
<div class="modal-overlay" id="resultModal">
    {% with prediction_label|lower as prediction_lower %}
    <div class="modal-card animate-fade-in-up 
        {% if "healthy" in prediction_lower %}status-healthy
        {% elif "mild" in prediction_lower or "moderate" in prediction_lower %}status-mild
        {% else %}status-critical
        {% endif %}
    ">
        <h3 class="modal-title">{{ prediction_label }}</h3>
        <p class="modal-text">{% trans "Prediction Score" %}: <strong>{{ prediction_score }}</strong></p>
        <button id="okBtn" class="btn btn-primary">{% trans "OK" %}</button>
    </div>
    {% endwith %}
</div>
{% endif %}

<style>
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem; /* Added vertical gap */
    }
    @media (max-width: 576px) {
        .form-grid { grid-template-columns: 1fr; }
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(5px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }
    .modal-card {
        background: var(--color-surface);
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        text-align: center;
        max-width: 400px;
        width: 90%;
        /* NEW: Added status border */
        border-top: 5px solid var(--color-border);
    }
    
    /* NEW: Modal Status Colors */
    .modal-card.status-healthy { border-top-color: var(--color-success); }
    .modal-card.status-mild { border-top-color: var(--color-warning); }
    .modal-card.status-critical { border-top-color: var(--color-danger); }

    /* Removed .modal-emoji */
    .modal-title { 
        font-size: 1.75rem; 
        color: var(--color-text); 
        margin-top: 0.5rem; /* Added margin */
    }
    .modal-text { font-size: 1rem; color: var(--color-text-muted); }
    .modal-card .btn { width: 100%; margin-top: 1.5rem; }
</style>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const okBtn = document.getElementById("okBtn");
    if (okBtn) {
      okBtn.addEventListener("click", () => {
        // Hide modal and redirect
        document.getElementById("resultModal").style.display = 'none';
        window.location.href = "{% url 'student_dashboard' %}";
      });
    }
  });
</script>
{% endblock %}