{% extends 'base.html' %}
{% block content %}

<!-- ğŸŒˆ Dashboard Wrapper -->
<div class="teacher-dashboard d-flex flex-column align-items-center py-5">

  <div class="container">
    <div class="card shadow-lg p-4 rounded-4 bg-white animate-fade-in">

      <!-- ğŸ« Header -->
      <div class="text-center mb-4">
        <h2 class="fw-bold text-gradient mb-2">ğŸ« Teacher Dashboard</h2>
        <p class="fs-5 text-muted mb-0">Welcome back, <strong>{{ request.user.username }}</strong> ğŸ‘‹</p>
      </div>

      <!-- ğŸ”” Alerts -->
      {% if messages %}
      <div class="mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} shadow-sm fade show rounded-pill text-center small" role="alert">
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- ğŸ“ Pending Requests -->
      <hr class="my-4">
      <h4 class="mb-3 fw-semibold">ğŸ“ Pending Join Requests</h4>
      {% if pending_requests %}
      <div class="table-responsive">
        <table class="table table-bordered align-middle text-center shadow-sm rounded-3 overflow-hidden">
          <thead class="table-warning text-dark">
            <tr>
              <th>Student</th>
              <th>Class</th>
              <th>Section</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for req in pending_requests %}
            <tr>
              <td>{{ req.student.user.get_full_name|default:req.student.user.username }}</td>
              <td>{{ req.class_name }}</td>
              <td>{{ req.section|upper }}</td>
              <td>
                <a href="{% url 'approve_request' req.id %}" class="btn btn-success btn-sm rounded-pill me-1 px-3">âœ… Approve</a>
                <a href="{% url 'reject_request' req.id %}" class="btn btn-danger btn-sm rounded-pill px-3">âŒ Reject</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted fst-italic">No pending requests at the moment.</p>
      {% endif %}

      <!-- ğŸ”” Notifications -->
      <hr class="my-4">
      <h4 class="mb-3 fw-semibold">ğŸ”” Notifications 
        {% if unread_count > 0 %}
        <span class="badge bg-danger ms-1">{{ unread_count }}</span>
        {% endif %}
      </h4>
      {% if notifications %}
      <ul class="list-group shadow-sm rounded-3">
        {% for n in notifications %}
        <li class="list-group-item d-flex justify-content-between align-items-center {% if not n.is_read %}fw-bold{% endif %}">
          <span>{{ n.message }}</span>
          <small class="text-muted">{{ n.created_at|date:"M d, H:i" }}</small>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted fst-italic">No notifications yet.</p>
      {% endif %}

      <!-- ğŸ“˜ Classes -->
      <hr class="my-4">
      <h4 class="mb-3 fw-semibold">ğŸ“˜ My Classes</h4>
      {% if classes %}
      <div class="table-responsive">
        <table class="table table-striped table-hover text-center align-middle shadow-sm rounded-3 overflow-hidden">
          <thead class="table-dark">
            <tr>
              <th>Class</th>
              <th>Section</th>
              <th>Total Students</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for c in classes %}
            <tr>
              <td>{{ c.class_name }}</td>
              <td>{{ c.section|upper }}</td>
              <td>{{ c.student_count }}</td>
              <td>
                <a href="{% url 'classroom_detail' c.id %}" class="btn btn-primary btn-sm rounded-pill px-3">ğŸ‘ View</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted fst-italic">No virtual classrooms yet.</p>
      {% endif %}

      <!-- â• Create New Class -->
      <hr class="my-4">
      <h4 class="fw-semibold mb-3">â• Create New Class</h4>
      <form method="post" class="p-3 rounded-3 shadow-sm bg-light">
        {% csrf_token %}
        <div class="row g-2">
          <div class="col-md-4">
            <input type="text" name="class_name" class="form-control rounded-pill" placeholder="Class (e.g. 4)" required>
          </div>
          <div class="col-md-4">
            <input type="text" name="section" class="form-control rounded-pill" placeholder="Section (e.g. A)" required>
          </div>
          <div class="col-md-4 text-center">
            <button type="submit" class="btn btn-success w-100 rounded-pill shadow-sm">â• Create</button>
          </div>
        </div>
      </form>

    </div>
  </div>
</div>

<!-- ğŸŒˆ Styles -->
<style>
.teacher-dashboard {
  background: linear-gradient(-45deg, #007bff, #00c6ff, #17a2b8, #6f42c1);
  background-size: 400% 400%;
  animation: gradientFlow 12s ease infinite;
  min-height: calc(100vh - 60px);
}

.text-gradient {
  background: linear-gradient(90deg, #007bff, #00c6ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.card {
  background: #ffffffee;
  backdrop-filter: blur(12px);
  border: none;
}

.animate-fade-in {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeInUp 1s ease forwards;
}

@keyframes fadeInUp {
  to { opacity: 1; transform: translateY(0); }
}

@keyframes gradientFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.table th, .table td {
  vertical-align: middle !important;
}

.btn {
  transition: all 0.3s ease;
}
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0,0,0,0.1);
}
</style>

{% endblock %}
